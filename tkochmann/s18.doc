


    
    
    
    =======================  M E M O R A N D U M  ======================
    
           DATE:  JULY 30,1982
    
             TO:  DISTRIBUTION
    
           FROM:  BILL BISHOP
    
        SUBJECT:  ENGINE MICROCODE VERSION S18
    
    ====================================================================
    
    

            VERSION S18 OF THE  TYMNET ENGINE MICROCODE IS  NOW RELEASED
    BY  NETWORK  DEVELOPMENT.   THE NEW  CAPABILITIES  PROVIDED  BY THIS
    VERSION ARE AS FOLLOWS:

    1.  SUPPORT OF SYNC LINE SPEEDS UP TO 19.2KB USING THE STANDARD SYNC
    CARD.

    2.  INCREASED EFFICIENCY OF SYNC CARD INTERRUPT HANDLING.

    3.  ENHANCEMENT OF THE  CKSUM INSTRUCTION TO ELIMINATE  MISSED ASYNC
    INTERRUPTS ON MACHINES WITH DMA AND TO PERMIT CHECKSUMMING BLOCKS UP
    TO 64K BYTES LONG.

    4.  INCREASED EFFICIENCY OF THE ARAND, ALIGN, AND COPY INSTRUCTIONS.

            VERSION  S18  AFFECTS ONLY  THE  8  PROMS IN  ROW  3  OF THE
    MICROCODE ON THE ROM/IO CARD.  ROWS 0, 1 AND 2 AND THE MAPPING PROMS
    ARE UNCHANGED.   (SEE ATTACHMENT  FOR A  SUMMARY OF  EXISTING ENGINE
    MICROCODE VERSIONS.)



    DEPLOYMENT CONSIDERATIONS
    -------------------------

            IT IS EXPECTED THAT  VERSION S18 MICROCODE WILL  BE DEPLOYED
    IN THE FOLLOWING MACHINES:

    1.  THOSE PROVIDING 19.2KB SYNC SUPPORT WITH THE STANDARD  SYNC CARD
    (INCLUDING TYMNET-I  AS WELL AS  TYMNET II NODES,  MINI-ENGINES, AND
    ENGINES WITHOUT DMA/SIO CAPABILITY.)

    2.  THOSE  CONFIGURED FOR  4800 BAUD ASYNC  AND DMA  (ESPECIALLY MSC
    DISK  CONTROLLER).  PREVIOUS  MICROCODE VERSIONS  COULD  CAUSE ASYNC
    INTERRUPTS TO BE MISSED CREATING INVERTED DATA ON ASYNC PORTS.
                                                                          1


    3.  THOSE RUNNING APPLICATIONS REQUIRING THE ABILITY  TO EFFICIENTLY
    CHECKSUM LARGE BLOCKS OF DATA (E.G. SUPERVISOR, PASCAL, ETC.)

    4.  ALL NEW MACHINES.



    TESTING
    -------

            VERSION  S18  HAS  UNDERGONE OVER  4  MONTHS  OF  TESTING IN
    BUBBNET UNDER A WIDE  RANGE OF HARDWARE AND  SOFTWARE CONFIGURATIONS
    INCLUDING:

                  - TYMNET I ISIS AND STAND ALONE

                  - TYMNET II ISIS AND STAND ALONE

                  - ENGINES AND MINI-ENGINES

                  - DMA/SIO

                  - 300MB DISC

                  - 4800 BAUD ASYNC

                  - CORE AND SEMI-MEMORY

                  -  HARDWIRED  SYNC LINES  AND  GANDALF  MODEMS @
          19.2KB.  (NOTE:   19.2KB OPERATION  HAS NOT  BEEN TESTED
          WITH OTHER TYPES  OF INTERFACES.  IF  OTHER REQUIREMENTS
          ARISE, TESTING  WILL BE  NECESSARY TO  VERIFY SUCCESSFUL
          OPERATION @ 19.2KB.)



    HARDWARE/SOFTWARE REQUIREMENTS
    ------------------------------

            THERE ARE CERTAIN  HARDWARE AND SOFTWARE REQUIREMENTS  TO BE
    CONSIDERED WHEN USING VERSION S18:

    1.  MINIMUM  SOFTWARE VERSIONS THAT  SUPPORT VERSION S18  (TO HANDLE
    THE NEW CKSUM INSTRUCTION):

                  - TYMNET-II NODE CODE VERSION 4.01

                  - ISIS KERNEL VERSION 5.01

                  - ALL VERSIONS  OF TYMNET-I NODE CODE  (ISIS AND
          STAND ALONE) (NOTE:  TYMNET-I ISIS NODE CODE IS DESIGNED
          TO OPTIMIZE SYNC LINE BANDWIDTH AT 9.6KB.  THEREFORE, IT
          MAY NOT  KEEP A  LINE FULLY SATURATED  WITH DATA  AT THE
                                                                          2


          19.2KB RATE WITHOUT  MODIFICATION OF THE CODE,  WHICH IS
          CURRENTLY NOT PLANNED.  (BANDWIDTH UTILIZATION  HAS BEEN
          OBSERVED IN THE 80-85% RANGE.)  TYMNET-II NODE CODE DOES
          NOT EXPERIENCE THIS PROBLEM.  TESTING HAS BEEN DONE ON A
          TYMNET-II  MULTI-LINE  LINK CONSISTING  OF  EIGHT 19.2KB
          LINES RUNNING  FULLY SATURATED  AND HANDLING  OVER 19000
          CPS IN BOTH DIRECTIONS.)

    2.  MAXIMUM CABLE  LENGTHS FOR SYNC LINES  @ 19.2KB ARE  SHORTER (83
    FT. TYPICAL, 38 FT. GUARANTEED) THAN WHEN RUNNING AT 9.6.

    3.  WHEN USING GANDALF MODEMS, A HIGH SPEED FILTER  MODULE (#1157A1)
    MUST BE USED TO RUN AT 19.2KB.

    4.  IF 19.2KB CLOCKS ARE TO  BE SUPPLIED BY THE SYNC CARD,  A SIMPLE
    MODIFICATION  IS  REQUIRED  TO  CONVERT  THE  EXISTING  CLOCK SPEEDS
    AVAILABLE ON THE CARD FROM 4.8KB AND 9.6KB TO 9.6KB AND  19.2KB.  AN
    ECO NUMBER HAS NOT  YET BEEN ASSIGNED FOR THE  MODIFICATION.  (NOTE:
    19.2KB  CLOCKS ARE  NOT  VISIBLE OR  AUDIBLE ON  THE  ENGINE MONITOR
    PANEL.)

    5.  THE WINDOW SIZE FOR  19.2KB LINES MAY HAVE TO BE  INCREASED OVER
    THAT SPECIFIED FOR 9.6KB LINES TO PREVENT EXCESSIVE RETRANSMISSIONS.



    DESCRIPTION OF MICROCODE CHANGES
    --------------------------------

    1.  SYNC LINE INTERRUPT HANDLING

            THE SYNC MICROCODE HANDLES INTERRUPTS FROM THE SYNC CARD AND
    DOES I/O WITH THE CARD AS REQUIRED.  MEANWHILE, THE SYNC  CARD SCANS
    EACH OF THE 16 LINES ON A ROUND-ROBIN BASIS, SAMPLING INPUT DATA AND
    TRANSMITTING OUTPUT  DATA FOR EACH  LINE.  HOWEVER, SCANNING  OF THE
    SYNC  LINES  IS HALTED  WHEN  INPUT OR  OUTPUT  WITH THE  CPU  IS IN
    PROGRESS.  MORE  SPECIFICALLY, WHEN THE  CPU ASSERTS I/O  SIGNALS DR
    (DATA REQUEST) OR DA (DATA AVAILABLE), THE LINE SCAN COUNTER  ON THE
    SYNC  CARD IS  STOPPED  UNTIL THE  SIGNAL IS  REMOVED,  AND SCANNING
    RESUMES.  THUS, THE LENGTH OF TIME BETWEEN LINE SAMPLES  IS AFFECTED
    BY THE DUTY CYCLE OF THE DR OR DA SIGNALS.

            PREVIOUS VERSIONS OF MICROCODE CAUSED THE DR AND  DA SIGNALS
    TO BE ASSERTED FOR LONGER THAN NECESSARY.  WITH NO I/O ACTIVITY, THE
    SYNC CARD  SCANS ALL  LINES IN 16  MICROSECONDS.  BUT  WITH MULTIPLE
    INTERRUPTS OCCURRING  AND CAUSING FREQUENT  I/O OPERATIONS,  THE OLD
    MICROCODE  COULD  CAUSE  THAT  SCAN  PERIOD  TO  BE  AS  LONG  AS 32
    MICROSECONDS.  SINCE A CLOCK TRANSITION OCCURS EVERY 26 MICROSECONDS
    AT 19.2KB, THIS WOULD RESULT  IN MISSED BITS IN THE DATA  STREAM AND
    CAUSE  ERRORS.   VERSION  S18  MICROCODE  RELIEVES  THIS  PROBLEM BY
    ASSERTING DR AND DA ONLY AS LONG AS NECESSARY, RESULTING IN  A WORST
    CASE LINE SCAN PERIOD OF 22 MICROSECONDS.  THIS IS  STILL SUFFICIENT
    TO DETECT TRANSITIONS IN THE CLOCKS AT 19.2KB.
                                                                          3


            IN  ADDITION,  THE  EFFICIENCY  OF  THE  MICROCODE INTERRUPT
    HANDLING  HAS BEEN  INCREASED BY  ELIMINATING AN  UNNECESSARY MEMORY
    CYCLE.   WHEN INTERRUPT  HANDLING WAS  COMPLETED, PRIOR  VERSIONS OF
    MICROCODE WOULD START UP A MEMORY REQUEST TO REFETCH THE INSTRUCTION
    WHICH HAD PREVIOUSLY  BEEN FETCHED (BUT  NOT YET EXECUTED)  WHEN THE
    INTERRUPT OCCURRED.  HOWEVER,  SINCE THE INTERRUPTED  INSTRUCTION IS
    STILL IN  THE INSTRUCTION REGISTER,  VERSION S18 SIMPLY  DECODES THE
    INSTRUCTION OPCODE WITHOUT WAITING FOR AN ADDITIONAL MEMORY CYCLE TO
    REFETCH IT.

    2.  CKSUM INSTRUCTION

            THE CKSUM INSTRUCTION  CALCULATES THE VERTICAL  AND DIAGONAL
    CHECKSUM FOR A SPECIFIED  BLOCK OF MEMORY.  PRIOR  MICROCODE LIMITED
    THE MAXIMUM BLOCK  SIZE TO 128  (DECIMAL) BYTES, WHICH  UNDER NORMAL
    CONDITIONS RESULTED IN A WORST CASE EXECUTION TIME  OF APPROXIMATELY
    60 MICROSECONDS.  HOWEVER, IF  THERE IS DMA ACTIVITY ON  THE MACHINE
    CONTENDING FOR  MEMORY CYCLES, THE  EXECUTION TIME COULD  EXCEED THE
    INTERVAL BETWEEN ASYNC  INTERRUPTS (69.4 MICROSECONDS FOR  4800 BAUD
    CONFIGURATIONS).  THIS  COULD CAUSE  AN INTERRUPT  TO BE  MISSED AND
    RESULT IN BAD DATA ON ASYNC PORTS.

            VERSION S18  CORRECTS THIS PROBLEM  BY REFETCHING  THE CKSUM
    INSTRUCTION EVERY 64 (DECIMAL) BYTES THAT ARE  CHECKSUMMED, ALLOWING
    INTERRUPTS TO BE SERVICED  DURING THE EXECUTION OF  THE INSTRUCTION.
    MOREOVER,  THE  MAXIMUM  BLOCK  SIZE  HAS  BEEN  INCREASED  TO 65534
    (DECIMAL)  BYTES  PERMITTING  MORE VERSITILITY  IN  THE  USE  OF THE
    INSTRUCTION.

            HOWEVER,  TO  ALLOW  REFETCHING  OF  THE   INSTRUCTION,  THE
    REGISTERS CONTAINING  THE NEGATIVE BYTE  COUNT AND  STARTING ADDRESS
    ARE NOW UPDATED  FOR EACH REFETCH AND  MAY NOT CONTAIN  THE ORIGINAL
    CONTENTS  AFTER  EXECUTION OF  THE  INSTRUCTION.   EXISTING SOFTWARE
    WHICH  EXPECTS  THE  REGISTERS  TO  REMAIN  UNCHANGED   MAY  REQUIRE
    MODIFICATION.

            IN  ADDITION, THE  PREVIOUS  VERSION OF  CKSUM  GENERATED AN
    ILLEGAL  INSTRUCTION  INTERRUPT  IF  THE  SPECIFIED  BYTE  COUNT WAS
    GREATER  THAN ZERO  OR LESS  THAN -128  (DECIMAL).  THE  NEW VERSION
    RESULTS IN AN ILLEGAL INSTRUCTION IF THE COUNT IS GREATER  THAN ZERO
    OR HAS THE LEAST SIGNIFICANT BIT SET (MUST SPECIFY AN EVEN NUMBER OF
    BYTES).   THERE  IS  NO  CHECK  FOR  MAXIMUM  BYTE  COUNT.  HOWEVER,
    SPECIFYING MORE THAN 65534 BYTES WILL PRODUCE INVALID RESULTS.

    3.  ARAND, ALIGN, AND COPY INSTRUCTIONS

            THESE   INSTRUCTIONS  ALSO   REFETCH  THEMSELVES   TO  ALLOW
    SERVICING  OF  INTERRUPTS  DURING  EXECUTION  OF   THE  INSTRUCTION.
    PREVIOUSLY, A MEMORY CYCLE WAS REQUESTED TO RE-READ  THE INSTRUCTION
    OPCODE FOR EVERY REFETCH.  HOWEVER, SINCE THE OPCODE REMAINS  IN THE
    INSTRUCTION  REGISTER, VERSION  S18 MERELY  DECODES  THE INSTRUCTION
    AGAIN  WITHOUT REQUIRING  AN  ADDITIONAL MEMORY  REFERENCE  AND THUS
    INCREASES THE OVERALL EFFICIENCY OF THE INSTRUCTIONS.
                                                                          4


            AN ASSEMBLY LISTING OF VERSION S18 MICROCODE CAN BE FOUND IN
    (BBISHOP:39)S18.LST.

            THIS DOCUMENT CAN BE FOUND IN (BBISHOP:39)S18.DOC.
                                                                          5


    
    
                            ENGINE MICROCODE VERSIONS
    
    
    
    VERSION S15
    -----------
    
    FUNCTIONAL DESCRIPTION:
    
            - BASIC INSTRUCTION SET IN ROWS 0,1
            - ENHANCED ASYNC SUPPORT IN ROW 2
            - ENHANCED SYNC SUPPORT IN ROW 3
    
    PROMS AFFECTED:
    
            ALL PROMS IN ROWS 0,1,2,3
            MAPPING PROMS 0,1 (MPS15-0,1)
    
    NOTES:
    
            ALL ENGINES SHOULD AT LEAST HAVE VERSION S15.
    
    
    VERSION S17
    -----------
    
    FUNCTIONAL DESCRIPTION:
    
            - IMPROVED POWER UP SEQUENCE
            - EXECUTION TIMES OF AR, SR, OR, XR, NR, LR, CLR, CR 
              INSTRUCTIONS REDUCED BY 1 MICROSTEP (125 NS)
            - SYNC INTERRUPT HANDLING MODIFIED FOR COMPATABILITY WITH
              MAC-II (OTHERWISE, 608 DEAD MICROCODE HALT RESULTED)
            - RTD INSTRUCTION BUG FIX (CAUSED LINE SNIP ERRORS ON MACHINES
              WITH DMA)
    
    PROMS AFFECTED:
    
            ALL PROMS IN ROWS 0,3
            MAPPING PROMS 0,1 (MPS17-0,1)
    
    NOTES:
    
            ALL ENGINES EXHIBITING POWER UP PROBLEMS OR MACHINES WITH 
            MAC-II OR DMA SHOULD BE UPGRADED TO VERSION S17.
    
    
    VERSION S17A
    ------------
    
    FUNCTIONAL DESCRIPTION:
    
                                                                          6


            - CORRECTS BUG CAUSING ERRORS IN SEMI-MEMORY
    
    PROMS AFFECTED:
    
            PROM 0 IN ROW 2
    
    NOTES:
    
            SHOULD BE USED IN ALL MACHINES WITH SEMI-MEMORY.  DOES NOT
            AFFECT SUP MACHINES.
    
    
    VERSION S18
    -----------
    
    FUNCTIONAL DESCRIPTION:
    
            - INCREASED EFFICIENCY OF SYNC INTERRUPT HANDLING
            - 19.2K BAUD SYNC CAPABILITY
            - CKSUM INSTRUCTION ENHANCED TO REFETCH EVERY 40X BYTES
              TO ALLOW INTERRUPTS.  ALSO INCREASES ALLOWABLE BLOCK
              SIZE FROM 128 BYTES TO 64K BYTES.
            - INCREASED EFFICIENCY OF ARAND, ALIGN AND HCOPY INSTRUCTIONS.
    
    PROMS AFFECTED:
    
            ALL PROMS IN ROW 3
    
    NOTES:
    
            SHOULD BE USED ON MACHINES WITH 19.2KB SYNC LINES OR MACHINES
            WITH 4800 BAUD ASYNC AND DMA.
    
    
    
    ENHANCED SUP MICROCODE - VERSION C16
    ------------------------------------
    
    FUNCTIONAL DESCRIPTION:
    
            - ENHANCED SUPERVISOR SUPPORT IN ROW 2 (REPLACES ENHANCED
              ASYNC)
    
    PROMS AFFECTED:
    
            ALL PROMS IN ROW 2
            MAPPING PROMS (MPC16-0,1 IF VERSION 15 IN ROWS 0,1,3
                           MPC17-0,1 IF VERSION 17 IN ROWS 0,3)
    
    NOTES:
    
            ONLY USED ON SUP MACHINES.  ALL SUPS SHOULD BE UPGRADED TO
            VERSION 17 IN ROWS 0,3 (ALL ROWS MAY BE LABELED AS VERSION 17
            FOR CONSISTENCY EVEN THOUGH SOME ROWS REMAIN UNCHANGED FROM
                                                                          7


            PREVIOUS VERSIONS.)
                                                                          8


    SUMMARY OF PROMS AFFECTED
    -------------------------
    
    
    VERSION         ROW 0   ROW 1   ROW 2   ROW 3   MAPPING
    -------         -----   -----   -----   -----   -------
    
      S15            ALL     ALL     ALL     ALL      ALL
    
      S17            ALL                     ALL      ALL
    
      S17A                          PROM 0
    
      S18                                    ALL
    
      C16 (SUP)                      ALL              ALL
    
    
    
    
    
                                                                          9


    
    
    DISTRIBUTION
    ------------
    
    DAVE ALCORN
    BILL EUSKE
    HOMER JAMISON
    DON JOHNSON
    CURT MILLER
    ZORAN SIMIC
    JACK SNAVELY
    JOE RINDE
    MIKE RUDE
    RON VIVIER
