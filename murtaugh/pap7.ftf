C
C************************
C
C       PAP7
C
C************************
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C       SUBROUTINE TO CHANGE THE TROUBLE NUMBER
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
        SUBROUTINE CHATRB(BAS,BAS10)
C
        INTEGER TRB(4),NTRB(4),TNUM,NUMBER,Z,BAS(3),IERT,IERC
        INTEGER MIDV(4),NT,BAS10(3)
C
90      Z=1
100     TYPE 105
105     FORMAT(1X,'TICKET NUMBER : ',$)
        ACCEPT 110,TNUM
110     FORMAT(I8)
        IF (TNUM.EQ.0) RETURN
114     CALL DBOPEN(BAS)
        CALL DBFIND(1,1,TNUM)
        CALL DBNREC(NUMBER)
        IF (NUMBER.EQ.0) GOTO 200
        CALL DBGREC($300,NUMBER)
        CALL DBVAL('TRB',TRB,48,NT)
        IF (NT.EQ.1) CALL DBVAL(40,MIDV(1))
        IF (NT.EQ.2) CALL DBVAL(42,MIDV(1))
        IF (NT.EQ.3) CALL DBVAL(43,MIDV)
        TYPE 115,TNUM,TRB
115     FORMAT(/1X,'THE CURRENT TROUBLE NUMBER FOR TICKET NUMBER ',I8,
     1  ' IS... ',/,/5X,4A5,/,/1X,'ENTER THE NEW VALUE OR A C.R. FOR ',
     2  'NO CHANGE : ',$)
        ACCEPT 120,NTRB
120     FORMAT(4A5)
        IF (NTRB(1).EQ.'     ') GOTO 300
        CALL CHA4A(BAS,44,NTRB,TNUM)
        CALL CHRE4A(BAS10,NT,MIDV,8,NTRB)
        RETURN
200     IF (Z.EQ.2) GOTO 215
        Z=2
        ENCODE(15,205,BAS)
205     FORMAT('BASE4',10X)
        GOTO 114
215     TYPE 220,TNUM
220     FORMAT(1X,'TICKET NUMBER ',I8,' CAN NOT BE FOUND. TRY AGAIN',
     1  ' PLEASE.')
        GOTO 90
295     TYPE 296,IERT,IERC
296     FORMAT(/3X,'ERROR TYPE = ',I5,4X,'ERROR CODE = ',I5,
     1  /,/2X,'CHANGE IS NOT COMPLETE.')
        RETURN
300     TYPE 305
305     FORMAT(1X,'NO CHANGE WAS MADE.')
        CALL DBCLOSE
        RETURN
        END
C
