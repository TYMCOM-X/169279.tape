:
: FOR VERSION 3.01. ESCALATION 43189
:
: ESCALATION 43189
:
: THE CODE RECEIVES A CALL REQUEST PACKET WITH CALLED ADDRESS
: 310690448700 AND NO CALL USER DATA.
:
: THE USERNAME 90448700 IS SENT TO SUP
: AND GET 'B405' SUP MESSAGE. USER ENTERS PASSWORD. IF THE DESTINATION
: HOST IS SHUT, SUP SENDS BACK 'HOST SHUT' MESSAGE AND THEN 'B4C1' 
; (PLEASE LOGIN).
: THE CODE WILL SET LOGIN TIMER WHEN 'B4C1' RECEIVED.
: WHEN TIMER EXPIRED, THE CIRCUIT WILL BE CLEARED IF WE ARE IN PSCALC
: PACKET STATE . (OTHERWISE, THE LOGIN TIMER WILL BE DISCARDED).
: PROBLEM OF THIS ESCALATION: WHEN LOGIN TIMER EXPIRE, LOGT ROUTINE
: FINDS WE ARE IN FLOW CONTROL STATE AND THEN IGNORE THE LOGIN-TIMER-
: EXPIRED-ACTION. CONSEQUENTLY, USER IS HUNG THERE AFTER ENTERING
: PASSWORD IF THE HOST IS SHUT.
:
: PATCH FUNCTION IS TO CHECK THE PACKET STATE. IF IN PFLOWC,
: ZAP THE CIRCUIT.



PATCH(861112,1400,JWANG,LOGT21+6,,6)
        J       PA1PTR,,
CONPATCH(PA1PTR,,1A)
        CLHI    R0,PSCALC
        JE      LOGT21+0E,,
        CLHI    R0,PFLOWC
        JN      LOGT10,,
        J       LOGT21+18,,     :NOT CHECK EXTLOG FLAG 
ENDPATCH(FORCE THE CODE TO HANDLE LOGIN TIMER PROCESS IN FLOW CONTROL)
ENDPATCH(STATE. ALSO, NOT CHECK EXTLOG)
